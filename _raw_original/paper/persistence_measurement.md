# 상태 유지 측정 (Persistence Measurement)

## 핵심 질문

> "STB 이후 상태가 유지되고 있는가?"를 정량적으로 측정

---

## 1. "유지"의 정확한 의미

유지된다는 건 예측이나 방향이 아니라, 다음 3가지 중 하나라도 살아있음을 뜻한다:

| 축 | 의미 |
|-----|------|
| 에너지 유지 | 가격이 임계 전이에 접근/도달할 잠재를 계속 보유 |
| 손실 억제 | 반대 에너지가 아직 지배권을 얻지 못함 |
| 시간 일관성 | 상태가 붕괴될 만한 사건이 발생하지 않음 |

> **유지 = "아직 실패가 증명되지 않았다"**

---

## 2. 유지 측정의 4대 계측 축 (V7 Core)

### A. 에너지 축 (Energy Persistence)

**측정값:**
- `MFE_slope`: 최근 n봉 MFE 증가율
- `MFE_stagnation_time`: MFE 정체 시간

**판정:**
```python
if MFE_slope >= 0:
    state = "유지"
else:
    state = "붕괴 신호"
```

> 포인트: EE는 필요 없고, MFE의 방향성만 본다.

---

### B. 손실 압력 축 (Loss Pressure)

**측정값:**
- `MAE / SL_ratio`
- `early_MAE_rate`: 초기 n봉 MAE 증가율

**판정:**
```python
if MAE / SL < 0.4:
    state = "유지"
elif MAE / SL >= 0.6:
    state = "붕괴 가속"
```

> Soft SL 실험(G3)이 성공한 이유: "손실 압력이 커지기 전에 경고"가 가능

---

### C. 시간 축 (Temporal Integrity)

**측정값:**
- `bars_since_entry`
- `time_to_first_MFE`

**판정:**
```python
if bars >= 4 and max_MFE < 1.5:
    state = "유지 약화 (LWS)"
```

> 이게 **LWS (Loss Warning State)**의 정확한 물리적 의미

---

### D. 구조 축 (Structural Continuity)

**측정값:**
- STB 조건 재붕괴 여부
- 구조 반증 이벤트 (극단 반대봉, 급격한 갭)

**판정:**
```python
if no_structural_rejection:
    state = "유지"
else:
    state = "종료"
```

> 중요: 구조는 예측이 아니라 "반증만 체크"

---

## 3. 유지 점수 (Persistence Score)

운용엔진에서 하나로 합치기:

```python
persistence_score = (
    w1 * energy_score +      # MFE slope
    w2 * loss_pressure +     # MAE/SL
    w3 * time_integrity +    # early MFE
    w4 * structure_ok        # binary
)
```

**권장 해석:**
- `score >= 0` → 유지
- `score < 0` → 붕괴 접근
- `score << 0` → 즉시 방어/종료

> 이건 예측 점수 아님. **"아직 살아있는가?" 점수**

---

## 4. 재진입 문제 해결

### 재정의

- ❌ 재진입 = 다시 들어간다
- ✅ 재진입 = 유지가 확인되면 포지션을 유지/관리한다

### 결론

- 추가 진입 ❌
- 상태 유지 관측 ✅
- 관리 로직 강화 ✅

---

## 5. STB 재진입 실험 결과 요약

### 핵심 결론

> **STB는 단발 신호가 아니다. STB는 "상태 진입 트리거"다.**

### 확인된 사실들

| 사실 | 내용 |
|------|------|
| 사실 1 | STB 이후 실패 ≠ 구조 붕괴. 첫 경로가 실패했을 뿐. |
| 사실 2 | 같은 조건 재진입은 의미 없음. IMPULSE 확률만 증가. |
| 사실 3 | 재진입 성립 조건 = 상태 유지 + 관측 정보 증가 |

### 최종 구조

```
❌ 우리가 버린 구조:
STB → 실패 → 동일 조건 재진입

✅ 우리가 확정한 구조:
STB → 경로 실패
     → 상태 유지
     → 관측 증가 (시간 / MFE / 반응)
     → 관리 로직 또는 종료
```

> 재진입은 "신호 재발생"이 아니라 "상태 지속 하 관측 강화"의 문제

---

## 6. 물리학적 연결

| 개념 | 물리적 의미 |
|------|------------|
| STB | 상태 점화 |
| 첫 진입 실패 | 점화 실패 |
| 재진입 시도 | ❌ (다시 불 붙이기) |
| 올바른 대응 | 연소 관측 + 보존 설계 |

---

## 7. 최종 결론

> **V7에서 "유지"란, 에너지가 아직 죽지 않았고 손실 압력이 지배하지 않았으며 구조 반증이 없다는 사실의 집합이다.**

이걸 측정할 수 있게 된 순간:
- 예측은 완전히 사라지고
- 재진입 논쟁도 끝나고
- **V7은 순수한 상태 물리 엔진이 된다**
